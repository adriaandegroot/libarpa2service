digraph finite_state_machine {
	rankdir=LR
	node [shape = doublecircle];
		S;
		E;

	node [shape = point ];
		qi

	node [shape = circle];
		qi	-> S;

		/* First do realm. */
		S	-> REALM1 [ label = "@" ];
		REALM1	-> LABEL1 [ label = "0-9A-Za-z" ];
		LABEL1	-> LABEL1 [ label = "0-9A-Za-z" ];
		LABEL1	-> REALM1 [ label = "-" ];
		LABEL1	-> REALM2 [ label = "." ];
		REALM2	-> LABEL2 [ label = "0-9A-Za-z" ];
		LABEL2	-> LABEL2 [ label = "0-9A-Za-z" ];
		LABEL2	-> REALM2 [ label = ". -" ];
		LABEL2	-> E [ label = "&epsilon;" ];

		/* Then username. */
		S	-> USERNAME [ label = "userchar" ];
		S	-> USERESC [ label = "\\" ];
		USERNAME	-> USERNAME [ label = "userchar" ];
		USERNAME	-> USERESC [ label = "\\" ];
		USERESC	-> USERNAME [ label = "%x00-FF" ];
		USERNAME	-> USERDOT [ label = "." ];
		USERDOT	-> USERNAME [ label = "userchar" ];
		USERNAME	-> REALM1 [ label = "@" ];
		USERNAME	-> E [ label = "&epsilon;" ];

	node[ shape=box, margin="0.2,0.2" ];
		userchar[ label = "userchar \n\n!#$%&'*+-/=?^_`{}|~\n%x80-FF\n0-9A-Za-z" ];
}
